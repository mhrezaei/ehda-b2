$(document).ready(function(){initialFilter();$(window).on("hashchange",function(a){initialFilter(true)})});var ajaxDelay=1;var ajaxTimer=new Timer();var runningXhr=null;var filterableAttributes=[];var filterData={};var filterUrl="";function initialFilter(d){var a=$(".filters-panel");filterData={};if(!isDefined(d)||!d){d=false}if(a.length){var b=a.attr("data-filter-url");if(typeof b!==typeof undefined){var c=decryptHash(getHashUrl());if(isDefined(c.pagination)&&isDefined(c.pagination["page"])){filterData.pagination={};filterData.pagination.page=c.pagination["page"]}filterUrl=b;a.find(".filter-text").each(function(f){var g=$(this);var e=g.attr("data-identifier");filterableAttributes.push(e);if(!d){g.on({keyup:function(h){filterWithText($(this).val(),e);if(h.originalEvent){modifyUrl()}}},"input[type=text]")}if(isDefined(c.text)&&isDefined(c.text[e])){g.find("input[type=text]").val(c.text[e]).change()}});a.find(".filter-slider").each(function(j){var h=$(this);var k=h.attr("data-identifier");var e=h.find(".slider-container");var l=e.find(".min-label");var i=e.find(".max-label");var g=parseInt(e.attr("data-min"));var m=parseInt(e.attr("data-max"));filterableAttributes.push(k);if(isDefined(c.range)&&isDefined(c.range[k])&&isDefined(c.range[k]["min"])&&isDefined(c.range[k]["max"])){var n=[c.range[k]["min"],c.range[k]["max"]]}else{var n=[g,m]}var f=e.find(".slider-self");if(d){f.slider("values",n)}else{f.slider({range:true,min:g,max:m,values:[g,m],change:function(o,p){l.html(forms_pd(nummber_format(p.values[0])));i.html(forms_pd(nummber_format(p.values[1])));filterWithRange(p.values[0],p.values[1],k);if(o.originalEvent){modifyUrl()}}});f.slider("values",n)}l.html(forms_pd(nummber_format(n[0])));i.html(forms_pd(nummber_format(n[1])))});a.find(".filter-checkbox").each(function(g){var h=$(this);var f=h.attr("data-identifier");filterableAttributes.push(f);if(!d){h.on({change:function(i){filterWithCheckBox(f);if(i.originalEvent){modifyUrl()}}},"input[type=checkbox]")}var e=h.find("input[type=checkbox]");if(isDefined(c.checkbox)&&isDefined(c.checkbox[f])){e.each(function(){var i=$(this).val();if($.inArray(i,c.checkbox[f])>-1){$(this).prop("checked",true)}else{$(this).prop("checked",false)}})}else{e.prop("checked",true)}if(!d){e.last().change()}});a.find(".filter-switch-checkbox").each(function(f){var g=$(this);var e=g.attr("data-identifier");filterableAttributes.push(e);if(!d){g.on({change:function(h){filterWithSwitchCheckBox($(this).is(":checked"),e);if(h.originalEvent){modifyUrl()}}},"input[type=checkbox]")}if(isDefined(c.switchKey)&&isDefined(c.switchKey[e])&&c.switchKey[e]){g.find("input[type=checkbox]").prop("checked",true)}else{g.find("input[type=checkbox]").prop("checked",false).change()}});console.log("here");modifyUrl();doFilter()}else{console.warn("Filter URL is not defined!")}}}function filterWithText(b,a){if(typeof filterData.text=="undefined"){filterData.text={}}filterData.text[a]=b}function filterWithRange(c,a,b){if(typeof filterData.range=="undefined"){filterData.range={}}filterData.range[b]={min:c,max:a};console.log(filterData)}function filterWithCheckBox(a,c){if(typeof c=="undefined"){c=false}var d=$("input[type=checkbox][id^="+a+"]");var b=[];d.each(function(){if($(this).is(":checked")){b.push($(this).val())}});if(typeof filterData.checkbox=="undefined"){filterData.checkbox={}}if(b.length<d.length){filterData.checkbox[a]=b}else{delete filterData.checkbox[a]}}function filterWithSwitchCheckBox(b,a){if(typeof filterData.switchKey=="undefined"){filterData.switchKey={}}if(b){filterData.switchKey[a]=b}else{delete filterData.switchKey[a]}}function encryptHash(b){var a="";$.each(b,function(c,e){if(Object.keys(e).length){a+="!";var d=[];$.each(e,function(g,h){var f=g+"_";switch(typeof h){case"boolean":d.push(f+((h)?1:0));break;case"string":d.push(f+h);break;case"object":if($.isArray(h)){$.each(h,function(j,k){if(typeof k=="boolean"){d.push(f+((k)?1:0))}else{d.push(f+k)}})}else{$.each(h,function(i,k){var j=f+i+"_";if(typeof k=="boolean"){d.push(j+((k)?1:0))}else{d.push(j+k)}})}break}});a+=d.join("/");a+="?"+c}});a+=((a)?"!":"");return a}function decryptHash(b){var a={};b=b.splitNotEmpty("!");if(b){$.each(b,function(c,d){d=d.splitNotEmpty("?");if(d.length==2){a[d[1]]=d[0].splitNotEmpty("/");a[d[1]]=prefixToIndex("_",a[d[1]])}})}return a}function doFilter(){ajaxTimer.delay(function(){var a=getHashUrl();var b=$(".product-list");runningXhr=$.ajax({type:"POST",url:filterUrl,data:{hash:a,_token:window.Laravel.csrfToken},beforeSend:function(){b.addClass("loading");if(runningXhr){runningXhr.abort();console.warn("Filter request canceled!")}},success:function(c){b.replaceWith($(c));b.removeClass("loading");modifyPaginationLinks()},complete:function(){runningXhr=null}})},ajaxDelay)}function modifyUrl(a){setHashUrl(encryptHash(filterData))}function modifyPaginationLinks(){$(".pagination li:not(.active):not(.disabled) a").each(function(){var d=$(this),c=d.attr("href");var b=getUrlParameterByName("page",c);if(b!=null){c=removeUrlParameterByName("page",c);filterData.pagination={};filterData.pagination.page=b;var a=encryptHash(filterData);d.attr("href",setHashUrl(a,c))}})}function resetFilters(){filterData={};modifyUrl()};